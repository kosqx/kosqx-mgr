\section{Metoda zmaterializowanych ścieżek}
\index{metoda!drzew prefiksowych|(textbf}\index{metoda!lineage|see{drzew prefiksowych}}

Metoda ta polega na przechowywaniu ciągu identyfikatorów wszystkich węzłów pomiędzy korzeniem a danym węzłem.
Są one przechowywane w pojedyńczym polu danego rekordu. 
Identyfikatorem może być dowolne unikalne pole \todo{term:pole?} tabeli.
Dobrym rozwiązaniem jest numeryczny klucz główny, lecz często bywa też stosowana unikalna nazwa węzła.


Ten opis nie wymusza konkretnej implementacji.
Listę elementów można przechowywać na wiele sposobów.
Jedynym wymogiem jest to by można było dokonać prostego pobrania identyfikatorów poszczególnych węzłów.
Przykładowo ciąg identyfikatorów całkowitoliczbowych \texttt{4, 8, 15, 16, 23, 42} można przechować jako:
\begin{itemize}
 \item tablicę \todo{term:array} np. \verb|{4, 8, 15, 16, 23, 42}|
% wady: dostpne tylko w wybranych bazach danych, niedostpne dla ORM, potencjalne problemy z indeksami
 \item napis z elememtami rozdzielonymi separatorami. 
    Przykładowo dla separatora~\verb|'.'| będzie to napis \verb|'4.8.15.16.23.42'|. 
    Ważne jest aby znak (lub znaki) będące separatorem nie mogły występować w identyfikatorze.
 \item napis z elememtami przekształconymi na napis stałej długości. 
    Przykładowo dla długości 3 będzie to \verb|'004008015016023042'|.
    Wadą tej metody jest konieczność jednorazowego długości napisu dla identyfikatora.
    Dla długości $n$ można przechować tylko $10^n-1$ węzłów\footnote{zakładając, że wszystkie dopuszczalne wartości znajdą się w użyciu, a usuwanie elementow tworzy luki}.
    Natomiast zastosowanie dużej $n$ zwiększa zużycie zasobów SZDB, oraz spowalnia działanie.
\end{itemize}




% TODO:
% - nie jest nawet w pierwszej postaci normmalnej
% - można zamiast sztucznych (primary key) identyfikatorów stosować unikalne nazwy
%   - przykładem tego są ścierzki plików, przykładowo /usr/bin/foo
%   - tak sugeruje się używać ltree

Metoda jest też zwana Lineage.


\operacja{Reprezentacja}

\begin{verbatim}[table] trie
>n1 _
id | path    | name
1  | 1       | Bazy Danych

>n2 n1
id | path    | name
2  | 1.2     | Obiektowe

>n3 n2
id | path    | name
3  | 1.2.3   | db4o

>n4 n1
id | path    | name
4  | 1.4     | Relacyjne

>n5 n4
id | path    | name
5  | 1.4.5   | Open Source

>n7 n5
id | path    | name
6  | 1.4.5.6 | PostgreSQL

>n8 n5
id | path    | name
7  | 1.4.5.7 | MySQL

>n9 n5
id | path    | name
8  | 1.4.5.8 | SQLite

>n6 n4
id | path    | name
9  | 1.4.9   | Komercyjne

>n10 n1
id | path    | name
10 | 1.10    | XML

\end{verbatim}

\temat{Operacje}

\operacja{Reprezentacja w SQL}
%! method-sql pathenum.create

\operacja{Wstawianie danych}
%! method-sql pathenum.insert

\operacja{Pobranie korzeni}
%! method-sql pathenum.roots

\operacja{Pobranie rodzica}
%! method-sql pathenum.parent

\operacja{Pobranie dzieci}
%! method-sql pathenum.children

\operacja{Pobranie przodków}
%! method-sql pathenum.ancestors

\operacja{Pobieranie potomków}
%! method-sql pathenum.descendants



\temat{Uwagi}

Dostosowania metody do przyjętego interfacu zmniejsza jej wydajność.
Praktycznie wszystkie zapytania zawierają podzapytanie które dla danego identyfikatora węzła \todo{term} pobierają jego ścieżkę.
Ta operacja jest w prawdzie bardzo szybka (kolumna \texttt{id} jest kluczem głównym) ale mimo wszystko mają wpływ na ogólną wydajność.
W razie stosowania tej metody warto sie zastanowić nad używaniem ścieżki (\texttt{path}) jako parametrów metod. 

Dodatkowo odwoływanie się do węzłów za pomocą ścieżek a nie identyfikatorów daje większe możliwości.
W takiej sytuacji można wykonać dodatkowe operacje bez konieczności wykonywania zapytań w bazie danych.
Są to:
\begin{itemize}
    \item
        Pobranie głebokości węzła w drzewie (wystarczy policzyć ilość elementów w ścieżce, zero oznacza korzeń\todo{dopisać})
    \item
        Wyznaczenie pierwszego wspólnego potomka
\end{itemize}

\temat{Wydajność}

\begin{qxtab}{pathenum}{Wydajność reprezentacji zmaterializowanych ścieżek}
%! result-table pathenum deep3
\end{qxtab}

\begin{qxfig}{pathenum}{Wydajność reprezentacji zmaterializowanych ścieżek}
%! result-chart pathenum deep3
\end{qxfig}


\index{metoda!drzew prefiksowych|)}
